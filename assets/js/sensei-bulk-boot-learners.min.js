/*! Sensei Bulk Boot Learners - v0.1.0
 * http://zao.is
 * Copyright (c) 2017; * Licensed GPL-2.0+ */
window.SenseiBoot=window.SenseiBoot||{},function(a,b,c,d,e){"use strict";d.processSize=5,d.processed=0,d.init=function(){c(b.body).on("click",".senseiboot-button",d._triggerProcessing),c(".wp_list_table_learners_mains .alternate").removeClass("alternate")},d._triggerProcessing=function(a){a.preventDefault();var b=c(this),e=b.data("bootfrom");b.hasClass("disabled")||(d.xhr&&d.xhr.abort(),d.removeLoadingRows(),d.triggerProcessing(b.parents("tr"),e))},d.triggerProcessing=function(b,e,f){if(!b.length||!e)return!1;var g,h,i=b.next(),j=d.processed+d.processSize;if(i.hasClass("boot-loading-row"))f&&(g=i.data("origcount"),i.find(".processed").text(j),h=j/g*100,i.find(".progress-bar span").css({width:(h>100?100:h)+"%"}),b.find(".column-num_learners").text(f));else{if(g=b.find(".column-num_learners").text(),g<1)return b.find(".senseiboot-button").addClass("disabled"),!1;i=c('<tr class="boot-loading-row" data-origcount="'+g+'"><td colspan="'+(b.find("> *").length-1)+'"><div class="progress-bar"><span></span></div></td><td class="info">'+d.l10n.processing.replace("%1$d",'<span class="processed">'+j+"</span>").replace("%2$d",'<span class="count">'+g+"</span>")+'<div class="spinner is-active"></div></td></tr>'),b.after(i)}return"undefined"==typeof f||f?void(d.xhr=c.post(a.ajaxurl,{action:"boot_from_course","to-process":d.processSize,"boot-from":e},function(a){a.success||d.failBoot(d.l10n.boot_error),a.data?(d.processed=j,d.triggerProcessing(b,e,a.data)):d.successfulBoot(b,i)}).fail(function(){d.failBoot(d.l10n.ajax_error)})):d.successfulBoot(b,i)},d.successfulBoot=function(b,c){c.find(".progress-bar span").css({width:"100%"}),c.find("td.info").html("<strong>"+d.l10n.success+"</strong>"),b.find(".column-num_learners").text(0),b.find(".senseiboot-button").addClass("disabled"),a.setTimeout(function(){c.fadeOut(400,function(){d.removeLoadingRows()})},4e3)},d.failBoot=function(b){d.removeLoadingRows(),a.alert(b)},d.removeLoadingRows=function(a){c(".boot-loading-row").remove()},c(d.init)}(window,document,jQuery,window.SenseiBoot);